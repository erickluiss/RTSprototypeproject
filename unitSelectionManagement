using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class UnitSelectionManagement : MonoBehaviour
{
    List<GameObject> SelectedUnits;
    List<GameObject> EnvironmentObjectSelected;
    GameObject unitSelected;
    GameObject highlight;
    GameObject environmentObjectSelected;
    GameObject eHighlight;
    
    void Start()
    {
        SelectedUnits = new List<GameObject>();
        EnvironmentObjectSelected = new List<GameObject>();
    }

    void Update()
    {
       if(Input.GetMouseButtonDown(0)){
            
            UnitSelecionSystem(unitSelected);
        }
        
    }


    void UnitSelecionSystem(GameObject unit){

        Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
        Physics.Raycast(ray, out RaycastHit hit);

        var shiftIsPressed = Input.GetKey(KeyCode.LeftShift);
        var objectClicked = hit.collider.gameObject;
        var playerUnitIsSelected = hit.transform.tag=="Selectable";
        var environmentObjectIsSelected = hit.transform.tag=="ESelectable";
         
        if(highlight || eHighlight != null){
            if(!shiftIsPressed){
                ClearAllSelections();
            }
        }
        
        if(playerUnitIsSelected){
            if(!shiftIsPressed || EnvironmentObjectSelected.Count >= 1) 
            {   
                ClearAllSelections();
            }
            unit = objectClicked;
            SelectedUnits.Add(unit);             
            ActivateHighlightOnUnitsListed();
        }
        
        if(environmentObjectIsSelected) {
            ClearAllSelections();
            unit = objectClicked;
            EnvironmentObjectSelected.Add(unit);
            ActivateHighlightOnUnitsListed();
        }
        unitSelected = unit;
    }
    
    void ActivateHighlightOnUnitsListed(){

        foreach(GameObject unitSelected in SelectedUnits){
            
            highlight = unitSelected.transform.Find("Highlight").gameObject;
            highlight.SetActive(true);
        }
        foreach(GameObject unitSelected in EnvironmentObjectSelected){
            
            eHighlight = unitSelected.transform.Find("eHighlight").gameObject;
            eHighlight.SetActive(true);
        }
    }

    void ClearAllSelections(){

        foreach(GameObject unitSelected in EnvironmentObjectSelected){
            
            eHighlight = unitSelected.transform.Find("eHighlight").gameObject;
            eHighlight.SetActive(false);
        }
        foreach(GameObject unitSelected in SelectedUnits){

            highlight = unitSelected.transform.Find("Highlight").gameObject;
            highlight.SetActive(false);
        }
        SelectedUnits.Clear();
        EnvironmentObjectSelected.Clear();
    }

} 

